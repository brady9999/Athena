<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Athena</title>
  <style>
    /* ===== Global Reset & Base ===== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Inter", system-ui, sans-serif;
  background: #f9fafb;
  color: #111;
  height: 100vh;
  display: flex;
}

/* ===== Layout ===== */
.app {
  display: flex;
  width: 100%;
}

.main-area {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ===== Sidebar ===== */
.sidebar {
  width: 260px;
  background: #1e293b;
  color: #f1f5f9;
  display: flex;
  flex-direction: column;
  padding: 1rem;
}

.brand {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: bold;
  font-size: 1.2rem;
  margin-bottom: 1rem;
}

.logo {
  width: 32px;
  height: 32px;
  background: #38bdf8;
  border-radius: 6px;
}

.new-chat {
  background: #38bdf8;
  border: none;
  padding: 0.6rem;
  border-radius: 6px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  margin-bottom: 1rem;
  transition: background 0.2s;
}
.new-chat:hover {
  background: #0ea5e9;
}

/* Conversation list */
.convos {
  flex: 1;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  padding-right: 0.25rem;
}

/* Each convo item */
.convo {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #334155; /* slate-700 */
  color: #f1f5f9;
  border: 1px solid transparent;
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
  text-align: left;
  cursor: pointer;
  transition: background 0.2s, border-color 0.2s, transform 0.1s;
  font-size: 0.9rem;
}

/* Title text */
.convo span:first-child {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Message count badge */
.convo span:last-child {
  background: #475569;
  color: #cbd5e1;
  font-size: 0.75rem;
  padding: 0.15rem 0.5rem;
  border-radius: 999px;
  margin-left: 0.5rem;
}

/* Hover and active states */
.convo:hover {
  background: #475569;
  transform: translateX(2px);
}

.convo.active {
  border-color: #38bdf8; /* accent blue */
  background: #1e293b;
}

.settings button {
  display: block;
  width: 100%;
  margin-bottom: 0.5rem;
  padding: 0.5rem;
  border: none;
  border-radius: 6px;
  background: #334155;
  color: #f1f5f9;
  cursor: pointer;
  transition: background 0.2s;
}
.settings button:hover {
  background: #475569;
}

/* ===== Topbar ===== */
.topbar {
  background: #f1f5f9;
  border-bottom: 1px solid #e2e8f0;
  padding: 0.75rem 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.title {
  font-size: 1.25rem;
  font-weight: 600;
}

.status {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  color: #475569;
}

.status .dot {
  width: 10px;
  height: 10px;
  background: #22c55e;
  border-radius: 50%;
}

/* ===== Chat Area ===== */
.main {
  flex: 1;
  padding: 1rem;
  overflow-y: auto;
  background: #fff;
}

.bubble {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.bubble.assistant .avatar {
  width: 32px;
  height: 32px;
  background: #38bdf8;
  border-radius: 50%;
}

.bubble .content {
  background: #f1f5f9;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  max-width: 70%;
}

.suggestions {
  margin-top: 0.5rem;
}
.suggestions .chip {
  background: #e2e8f0;
  border: none;
  border-radius: 16px;
  padding: 0.3rem 0.75rem;
  margin-right: 0.5rem;
  cursor: pointer;
  transition: background 0.2s;
}
.suggestions .chip:hover {
  background: #cbd5e1;
}

.meta {
  font-size: 0.75rem;
  color: #64748b;
  margin-top: 0.25rem;
}

/* ===== Input Section ===== */
.input {
  border-top: 1px solid #e2e8f0;
  padding: 0.75rem;
  background: #f9fafb;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.toolbar {
  display: flex;
  justify-content: space-between;
}

.icon-btn {
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  padding: 0.3rem;
  transition: transform 0.2s;
}
.icon-btn:hover {
  transform: scale(1.1);
}

.prompt {
  display: flex;
  gap: 0.5rem;
  align-items: flex-end;
}

textarea {
  flex: 1;
  resize: none;
  padding: 0.6rem;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-size: 1rem;
}

.actions {
  display: flex;
  gap: 0.5rem;
}

.primary {
  background: #38bdf8;
  color: white;
  border-radius: 6px;
  padding: 0.5rem 0.75rem;
}
.primary:hover {
  background: #0ea5e9;
}

.hint {
  font-size: 0.75rem;
  color: #94a3b8;
  text-align: right;
}


/* Typing indicator container */
.typing {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  margin: 0.5rem 0;
  padding: 0.5rem 0.75rem;
  background: var(--bubble, #f1f5f9);
  border-radius: 12px;
  width: fit-content;
}

/* Hide by default */
.hidden {
  display: none !important;
}

/* Dots */
.typing .dot {
  width: 8px;
  height: 8px;
  background: var(--accent, #38bdf8);
  border-radius: 50%;
  animation: bounce 1.2s infinite;
}

.typing .dot:nth-child(2) {
  animation-delay: 0.2s;
}
.typing .dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes bounce {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
  40% { transform: scale(1); opacity: 1; }
}
  </style>
</head>
<body class="dark">
  <div id="root" class="app">
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Sidebar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>Athena AI</div>
      </div>
      <button class="new-chat" id="newChatBtn" aria-label="Start new chat">+ New chat</button>
      <div class="convos" id="convos" role="listbox" aria-label="Conversations"></div>
      <div class="settings">
        <button id="modeBtn" class="mean">Mode: Mean</button>
       <!--<button id="themeBtn">Theme</button> -->
        <button id="clearBtn">Clear</button>
      </div>
    </aside>

    <!-- Main area -->
    <div class="main-area">
      <header class="topbar">
        <div class="title">Athena</div>
        <div class="status"><span class="dot"></span>Ready</div>
      </header>

      <main class="main" id="chat">
        <!-- Initial assistant bubble -->
        <article class="bubble assistant">
          <div class="avatar"></div>
          <div>
            <div class="content">Hey Brady‚Äîwhat are we building today?</div>
            <!--
            <div class="suggestions" id="suggestions">
              <button class="chip">Generate landing page copy</button>
              <button class="chip">Draft onboarding email</button>
              <button class="chip">Summarize a PDF</button>
            </div>
            <div class="meta">Tip: Press Shift+Enter for a new line</div>
          </div>
        -->
        </article>

        <!-- Typing indicator -->
        <div id="typingIndicator" class="typing hidden">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </main>

      <!-- Input -->
      <section class="input">
      <!--
        <div class="toolbar">
          <div class="toolbar-left">
            <button class="icon-btn" title="Attach">üìé</button>
            <button class="icon-btn" title="Commands">‚åò</button>
            <button class="icon-btn" title="Voice">üéôÔ∏è</button>
          </div>
          <div>
            <button class="icon-btn" id="stopBtn" title="Stop">‚èπÔ∏è</button>
          </div>
        </div>
      -->
        <div class="prompt">
          <textarea id="prompt" placeholder="Ask me anything‚Ä¶" aria-label="Your message"></textarea>
          <div class="actions">
            <button class="icon-btn" id="expandBtn" title="Expand">‚§¢</button>
            <button class="icon-btn primary" id="sendBtn" title="Send">‚û§</button>
          </div>
        </div>
        <div class="hint">#</div>
      </section>
    </div>
  </div>
  <script>
    // ---------------- STATE ----------------
const state = {
  convos: [],
  activeId: null,
  theme: localStorage.getItem('theme') || 'dark'
};

let mode = "mean"; // default personality

// ---------------- HELPERS ----------------
const $ = sel => document.querySelector(sel);
const el = (tag, props = {}, children = []) => {
  const node = document.createElement(tag);
  Object.assign(node, props);
  children.forEach(c => node.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
  return node;
};
const now = () => new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

// ---------------- THEME ----------------
function applyTheme(t) {
  document.body.classList.remove('light', 'dark');
  document.body.classList.add(t);
}
applyTheme(state.theme);

// ---------------- ID GENERATOR ----------------
function generateId() {
  if (window.crypto && crypto.randomUUID) return crypto.randomUUID();
  return 'xxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

// ---------------- CONVERSATIONS ----------------
function setActive(id) {
  state.activeId = id;
  renderConvos();
  renderChat();
  save();
}

function currentConvo() {
  return state.convos.find(c => c.id === state.activeId);
}

function newConvo() {
  const convo = { id: generateId(), title: "Untitled", messages: [] };
  state.convos.push(convo);
  setActive(convo.id);
  save();
  return convo;
}

function addMessage(role, content) {
  let convo = currentConvo();
  if (!convo) convo = newConvo();
  const msg = { id: generateId(), role, content, time: now() };
  convo.messages.push(msg);

  if (!convo.title || convo.title === 'Untitled') {
    convo.title = content.slice(0, 40) + (content.length > 40 ? '‚Ä¶' : '');
  }

  renderChat();
  renderConvos();
  save();
  return msg;
}

// ---------------- PERSISTENCE ----------------
function save() {
  localStorage.setItem('athena_ai', JSON.stringify({
    convos: state.convos,
    activeId: state.activeId,
    theme: state.theme
  }));
}
function load() {
  const raw = localStorage.getItem('athena_ai');
  if (!raw) return newConvo();
  const data = JSON.parse(raw);
  Object.assign(state, data);
  applyTheme(state.theme);
  renderConvos();
  renderChat();
}

// ---------------- RENDERING ----------------
function renderConvos() {
  const list = $('#convos');
  list.innerHTML = '';
  state.convos.forEach(c => {
    const item = el('button', { 
      className: 'convo' + (c.id === state.activeId ? ' active' : ''), 
      onclick: () => setActive(c.id) 
    }, [
      el('span', { textContent: c.title }),
      el('span', { textContent: c.messages?.length || 0 })
    ]);
    list.appendChild(item);
  });
}

function bubble(role, content, time) {
  return el('article', { className: `bubble ${role}` }, [
    el('div', { className: 'avatar', 'aria-hidden': 'true' }),
    el('div', {}, [
      el('div', { className: 'content', textContent: content }),
      el('div', { className: 'meta', textContent: time ? `${role} ‚Ä¢ ${time}` : role })
    ])
  ]);
}

function renderChat() {
  const feed = $('#chat');
  feed.innerHTML = '';
  const convo = currentConvo();
  if (!convo || convo.messages.length === 0) {
    const greeting = document.querySelector('article.bubble.assistant');
    if (greeting) feed.appendChild(greeting.cloneNode(true));
    return;
  }
  convo.messages.forEach(m => feed.appendChild(bubble(m.role, m.content, m.time)));
  feed.scrollTop = feed.scrollHeight;
}

// ---------------- CHAT LOGIC ----------------
document.addEventListener("DOMContentLoaded", () => {
  const sendBtn = $("#sendBtn");
  const promptInput = $("#prompt");
  const typingIndicator = $("#typingIndicator");

  async function sendMessage() {
    const message = promptInput.value.trim();
    if (!message) return;

    addMessage("user", message);
    promptInput.value = "";

    // Show typing indicator
    typingIndicator.classList.remove("hidden");

    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message, mode })
      });
      const data = await res.json();

      // Hide typing indicator
      typingIndicator.classList.add("hidden");

      addMessage("assistant", data.reply);
    } catch (err) {
      typingIndicator.classList.add("hidden");
      addMessage("assistant", "‚ö†Ô∏è Error connecting to Athena backend.");
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  promptInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // ---------------- BUTTONS ----------------
  // Mode toggle
  const modeBtn = $("#modeBtn");
  modeBtn.addEventListener("click", () => {
    mode = mode === "mean" ? "nice" : "mean";
    modeBtn.textContent = `Mode: ${mode.charAt(0).toUpperCase() + mode.slice(1)}`;
    modeBtn.className = mode; // apply .mean or .nice class
  });

  // Theme toggle
  $('#themeBtn').addEventListener('click', () => {
    state.theme = state.theme === 'dark' ? 'light' : 'dark';
    applyTheme(state.theme);
    save();
  });

  // Clear conversations
  $('#clearBtn').addEventListener('click', () => {
    if (!confirm('Clear all conversations?')) return;
    state.convos = [];
    state.activeId = null;
    save();
    newConvo();
  });

  // New chat
  $('#newChatBtn').addEventListener('click', () => newConvo());

  // Suggestions
  document.querySelectorAll('#suggestions .chip').forEach(chip => {
    chip.addEventListener('click', () => {
      $('#prompt').value = chip.textContent;
      sendMessage();
    });
  });

  // Boot
  load();
});
  </script>
</body>
</html>